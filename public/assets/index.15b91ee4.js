var ae=Object.defineProperty,ne=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var Z=(t,s,r)=>s in t?ae(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,D=(t,s)=>{for(var r in s||(s={}))oe.call(s,r)&&Z(t,r,s[r]);if(V)for(var r of V(s))le.call(s,r)&&Z(t,r,s[r]);return t},M=(t,s)=>ne(t,re(s));import{r as o,j as B,u as L,N as I,a as J,K as ce,T as ie,f as X,b as de,F as ue,h as $,L as ee,G as T,c as q,d as j,e as he,O as me,M as pe,g as Q,i as ge,R as fe,k as C,l as ve,m as Ne,B as ye}from"./vendor.a48c02f0.js";const be=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))d(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&d(h)}).observe(document,{childList:!0,subtree:!0});function r(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function d(a){if(a.ep)return;a.ep=!0;const l=r(a);fetch(a.href,l)}};be();const te=o.exports.createContext(),_=()=>o.exports.useContext(te),e=B.exports.jsx,n=B.exports.jsxs,S=B.exports.Fragment,xe=()=>{const{isLoggedIn:t,currentUser:s,removeUser:r}=_(),d=L(),a=()=>{r(),d("/")};return n("nav",{className:"navbar navbar-dark bg-dark px-5 py-3",children:[!t&&n(S,{children:[e(I,{className:"nav-link",to:"/",children:"Home"}),e(I,{className:"nav-link",to:"/login",children:"Log in"}),e(I,{className:"nav-link",to:"/signup",children:"Sign up"})]}),t&&n(S,{children:[s.role==="user"&&n(S,{children:[e(I,{className:"nav-link",to:"/listings",children:"Search"}),e(I,{className:"nav-link",to:"/favorites",children:"Favorites"})]}),s.role==="business"&&e(I,{className:"nav-link",to:"/dashboard",children:"Dashboard"}),e(I,{className:"nav-link",to:"/account",children:"My account"}),e("button",{className:"btn btn-danger",onClick:a,children:"Log out"})]})]})},Se=({setRole:t})=>{const{isLoggedIn:s,currentUser:r}=_(),d=L();return n("div",{children:[!s&&n("div",{id:"cover-image-auth-role",children:[e("h1",{style:{"font-size":"7rem",color:"white"},className:"py-5",children:"How will you help us stop wasting food?"}),e("button",{className:"btn btn-primary mx-4 px-3",onClick:()=>{t("user"),d("/signup")},children:"I will buy food"}),e("button",{className:"btn btn-primary mx-4 px-3",onClick:()=>{t("business"),d("/signup")},children:"I will sell food"})]}),s&&r.role==="user"&&d("/discover"),s&&r.role==="business"&&d("/dashboard")]})},E=J.create({baseURL:"https://no-food-waste-2911.herokuapp.com",withCredentials:!0});E.interceptors.request.use(t=>{const s=localStorage.getItem("authToken");return t.headers.Authorization=s?`Bearer ${s}`:"",t});//! Error handling to use in the catch
function W(t){var s,r;throw((s=t.response)==null?void 0:s.data)&&console.log(t.response&&((r=t.response)==null?void 0:r.data)),t}const x=M(D({},E),{signup(t){return E.post("/api/auth/signup",t).then(s=>{console.log(s)}).catch(W)},isLoggedIn(t){return E.get("/api/auth/me",{headers:{Authorization:`Bearer ${t}`}}).then(s=>s.data).catch(W)},signin(t){return E.post("/api/auth/signin",t).then(s=>s.data).catch(W)}}),we=({role:t})=>{const[s,r]=o.exports.useState(""),[d,a]=o.exports.useState(""),l=L(),{storeToken:h,authenticateUser:f,currentUser:u}=_();return console.log("This is current user",u),n(S,{children:[e("h1",{className:"pt-5",children:"Sign in"}),n("form",{className:"pb-5",onSubmit:c=>{const v={email:s,password:d};console.log("data in AuthSignin line 20",v),c.preventDefault(),x.signin(v).then(g=>{h(g.authToken),f(),u.role==="user"?l("/discover"):l("/dashboard")}).catch(g=>console.log(g))},children:[n("div",{className:"form-group p-5",children:[e("label",{className:"m-3",htmlFor:"email",children:"EMAIL"}),e("input",{className:"form-control",type:"text",name:"email",required:!0,onChange:c=>r(c.target.value)}),e("label",{className:"m-3",htmlFor:"password",children:"PASSWORD"}),e("input",{className:"form-control",type:"password",name:"password",required:!0,onChange:c=>a(c.target.value)})]}),e("button",{className:"btn btn-primary px-5 py-2",children:"LOG IN"})]})]})},O=J.create({baseURL:"https://no-food-waste-2911.herokuapp.com",withCredentials:!0});O.interceptors.request.use(t=>{const s=localStorage.getItem("authToken");return t.headers.Authorization=s?`Bearer ${s}`:"",t});//! Error handling to use in the catch
function Y(t){var s,r;throw((s=t.response)==null?void 0:s.data)&&console.log(t.response&&((r=t.response)==null?void 0:r.data)),t}const R=M(D({},O),{signup(t){return O.post("/api/auth/signup",t).then(s=>{console.log(s)}).catch(Y)},isLoggedIn(t){return O.get("/api/auth/me",{headers:{Authorization:`Bearer ${t}`}}).then(s=>s.data).catch(Y)},signin(t){return O.post("/api/auth/signin",t).then(s=>s.data).catch(Y)}}),ke=({role:t})=>{const[s,r]=o.exports.useState({name:"",email:"",password:"",role:t});console.log(s);const d=L();return n(S,{children:[e("h2",{className:"pt-5",children:"Create an account"}),n("form",{onSubmit:h=>{h.preventDefault(),console.log("during the handleSubmit",s),R.signup(s).then(f=>{console.log("This is coming back from the server !",f),d("/login")}).catch(f=>{console.log("THIS IS THE ERROR",f)})},onChange:h=>{r(f=>M(D({},f),{[h.target.id]:h.target.value})),console.log("after the handleChange",s)},className:"pb-5",children:[n("div",{className:"form-group p-5",children:[e("label",{className:"m-3",htmlFor:"name",children:"NAME"}),e("input",{className:"form-control",type:"text",id:"name",required:!0}),e("label",{className:"m-3",htmlFor:"email",children:"EMAIL"}),e("input",{className:"form-control",type:"text",id:"email",required:!0}),e("label",{className:"m-3",htmlFor:"password",children:"PASSWORD"}),e("input",{className:"form-control",type:"password",id:"password",required:!0})]}),e("button",{className:"btn btn-primary px-5 py-2",children:"SIGN UP"})]}),e(I,{to:"/login",role:t,children:e("h3",{children:"Already registered ? Log in"})})]})},Ce=({setBusiness:t,setStep:s})=>{const[r,d]=o.exports.useState(""),[a,l]=o.exports.useState(""),[h,f]=o.exports.useState(""),[u,m]=o.exports.useState(""),c=o.exports.useRef(""),v=g=>{g.preventDefault(),t(i=>M(D({},i),{name:r,address:a,phone:h,description:u,picture:c.current.files[0]})),s(2)};return n("form",{className:"p-4",children:[e("h2",{children:"Describe your business"}),e("p",{children:"Please tell us a little bit more about your business so that we can settle your account"}),e("h3",{children:"Confirm the name and location of your business"}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"text",name:"name",placeholder:"Name of your business",onChange:g=>d(g.target.value)})}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"text",name:"address",placeholder:"Address of your business",onChange:g=>l(g.target.value)})}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"number",name:"phone",placeholder:"Phone number",onChange:g=>f(Number(g.target.value))})}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"text",name:"description",placeholder:"Give us a quick description of your business",onChange:g=>m(g.target.value)})}),e("p",{children:"You can also provide a picture for your business. While not mandatory, it will help users differentiating your listings with others."}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control-file",ref:c,type:"file",name:"picture"})}),e("button",{className:"btn btn-primary px-5 py-2",onClick:g=>v(g),children:"Register"})]})},Ae=({setBusiness:t,setStep:s})=>{const[r,d]=o.exports.useState([]),[a,l]=o.exports.useState([]);o.exports.useEffect(()=>{x.get("/api/category").then(u=>{console.log("dbRes.data line 13 >>>>>>>",u.data),d(u.data)}).catch(u=>console.error(u))},[]),console.log("Options >>> line 16",r);const h=u=>{const m=[],c=u.target.selectedOptions;for(let v=0;v<c.length;v++)m.push(c[v].value);l(m)},f=u=>{u.preventDefault(),t(m=>M(D({},m),{tags:a})),s(3)};return n("form",{className:"p-4",children:[e("h2",{children:"Describe the products you sell"}),e("p",{children:"Tell us what kind of products you will be selling. This information will appear in the app."}),e("h3",{children:"Which tags best describe your business and products?"}),e("div",{className:"dropdown m-3",children:e("select",{type:"text",name:"tags",placeholder:"Select all relevant tags",onChange:u=>h(u),multiple:!0,children:r&&r.map(u=>e("option",{className:"dropdown-item",value:u._id,children:u.name}))})}),e("button",{className:"btn btn-primary",onClick:u=>f(u),children:"Ok"})]})},Le=({business:t})=>{const[s,r]=o.exports.useState(null),[d,a]=o.exports.useState(null),l=L(),h=m=>{r(new Date(m.target.value))},f=m=>{a(new Date(m.target.value))},u=m=>{m.preventDefault();const c=new FormData;c.append("name",t.name),c.append("address",t.address),c.append("phone",t.phone),c.append("description",t.description),c.append("picture",t.picture),c.append("tags",t.tags),c.append("startTimeSlot",s),c.append("endTimeSlot",d),x.post("/api/business/create",c).then(()=>{console.log("Hey, do you arrive here??????"),l("/dashboard")}).catch(v=>console.error(v))};return n("form",{className:"p-4",children:[e("h2",{children:"At what time can users pick up their order?"}),e("p",{children:"Set your timeslots below for pickup. Note that the majority of our partners set this timeslot between 15 to 30 minutes before closing."}),e("label",{htmlFor:"startTime"}),e("input",{className:"m-3",type:"datetime-local",id:"startTime",onChange:m=>h(m)}),e("label",{htmlFor:"endTime"}),e("input",{className:"m-3",type:"datetime-local",id:"endTime",onChange:m=>f(m)}),e("button",{className:"btn btn-primary",onClick:m=>u(m),children:"Register timeslots"})]})},Te=()=>{const[t,s]=o.exports.useState(1),[r,d]=o.exports.useState({owner:"",name:"",phone:"",address:"",description:"",picture:"",listings:[],tags:[],timeSlots:[]});return n("div",{children:[e(S,{children:"Hello"}),t===1&&e(Ce,{setBusiness:d,setStep:s}),t===2&&e(Ae,{setBusiness:d,setStep:s}),t===3&&e(Le,{business:r})]})},Ie=({business:t,setBusiness:s})=>{const r=L(),d=l=>{r(`/listings/${l}/update`)},a=l=>{x.delete(`/api/listings/${t._id}/delete/${l}`).then(h=>{s(h.data)}).catch(h=>console.error(h))};return n(S,{children:[e("img",{className:"mt-5",style:{width:200},src:t.picture,alt:t.name}),e("h1",{className:"p-5",children:t.name}),!t.listings.length&&e("p",{children:"You don't have any listings for the moment"}),t.listings.length>0&&n(S,{children:[e("h2",{className:"p-3",children:"My listings"}),n("div",{className:"container m-5",children:[n("div",{className:"row",children:[e("strong",{className:"col-sm p-4",children:"Name"}),e("strong",{className:"col-sm p-4",children:"Price"}),e("strong",{className:"col-sm p-4",children:"Available quantity"}),e("strong",{className:"col-sm p-4",children:"Description"}),e("strong",{className:"col-sm p-4",children:"Modify"}),e("strong",{className:"col-sm p-4",children:"Delete"})]}),t.listings.map(l=>n("div",{className:"row",children:[e("span",{className:"col-sm p-4",children:l.name}),n("span",{className:"col-sm p-4",children:[l.price," \u20AC"]}),e("span",{className:"col-sm p-4",children:l.availableQuantity}),e("span",{className:"col-sm p-4",children:l.description}),e("span",{style:{cursor:"pointer"},onClick:()=>d(l._id),className:"col-sm p-4",children:e(ce,{size:24})}),e("span",{style:{cursor:"pointer"},onClick:()=>a(l._id),className:"col-sm p-4",children:e(ie,{size:24})})]},l._id))]})]}),e("button",{className:"btn btn-primary px-5 py-2",onClick:()=>r("/listings/create",{state:{businessId:t._id}}),children:"Add a listing"})]})},_e=()=>{const{currentUser:t}=_(),[s,r]=o.exports.useState(""),d=L();return o.exports.useEffect(()=>{x.get("/api/business").then(a=>a.data.find(l=>l.owner===t._id)).then(a=>r(a)).catch(a=>console.error(a))},[]),n("div",{children:[!s&&n("div",{children:[e("p",{className:"p-5",children:"Vous n'avez pas encore de business enregistr\xE9"}),e("button",{className:"btn btn-primary py-2 px-5",onClick:()=>d("/onboarding"),children:"New business"})]}),s&&e(Ie,{business:s,setBusiness:r})]})},F=({listing:t})=>{var g,i,b;const[s,r]=o.exports.useState(X),[d,a]=o.exports.useState(""),[l,h]=o.exports.useState(""),{currentUser:f,storeToken:u}=_();o.exports.useEffect(()=>{var N,w;((w=f.favorites)==null?void 0:w.includes((N=t==null?void 0:t.owner)==null?void 0:N._id))?r(de):r(X)},[f]),o.exports.useEffect(()=>{const N=setInterval(()=>{c()},1e3);return()=>clearInterval(N)},[]);const m=(N,w)=>Math.round(Math.abs(N-w)/1e3/60),c=()=>{new Date().getHours()<new Date(t.owner.startTimeSlot).getHours()?(a("Will open soon"),h("green")):new Date().getHours()>new Date(t.owner.endTimeSlot).getHours()?(a("Come back tomorrow"),h("black")):m(new Date(t.owner.endTimeSlot).getHours(),new Date().getHours())<60?(a("Will close soon"),h("red")):new Date().getHours()===new Date(t.owner.endTimeSlot)&&(new Date().getMinutes()<new Date(t.owner.startTimeSlot).getMinutes()?(a("Will open in less than an hour"),h("green")):new Date().getMinutes()>new Date(t.owner.endTimeSlot).getMinutes()?(a("You just missed it ... Come back tomorrow!"),h("black")):m(new Date(t.owner.endTimeSlot).getMinutes(),new Date().getMinutes())<60&&(a("Will close in less than an hour"),h("red")))},v=()=>{x.patch(`/account/favorites/${t.owner._id}`).then(N=>{u(N.data)}).catch(N=>console.error(N))};return n("div",{className:"card",style:{width:"auto"},children:[e("img",{className:"card-img-top",src:(g=t.owner)==null?void 0:g.picture,alt:t.name}),n("div",{className:"card-body",children:[e("p",{style:{backgroundColor:l,color:"white"},children:d}),e("h5",{className:"card-title",children:t.name}),n("h5",{className:"card-text",children:["Price: ",t.price,"\u20AC"]}),e("p",{className:"card-text",children:(i=t.owner)==null?void 0:i.name}),e(ue,{style:{cursor:"pointer"},onClick:v,icon:s,size:"xs"}),n("p",{className:"card-text",children:["Pick up by ",$((b=t.owner)==null?void 0:b.endTimeSlot).format("ddd, hA")]}),n("p",{children:["Available quantity : ",t.availableQuantity]}),e(ee,{to:`/listing/${t._id}`,children:"See this offer"})]})]})};T.setApiKey("AIzaSyAWNUhMz1o6js88esl8_xmRkQgFOZr38nk");T.setLanguage("fr");const De=()=>{const[t,s]=o.exports.useState(0),[r,d]=o.exports.useState(0),[a,l]=o.exports.useState([]),[h,f]=o.exports.useState("");T.fromLatLng(t,r).then(c=>{const v=c.results[0].formatted_address;let g,i,b;for(let N=0;N<c.results[0].address_components.length;N++)for(let w=0;w<c.results[0].address_components[N].types.length;w++)switch(c.results[0].address_components[N].types[w]){case"locality":g=c.results[0].address_components[N].long_name;break;case"administrative_area_level_1":i=c.results[0].address_components[N].long_name;break;case"country":b=c.results[0].address_components[N].long_name;break}console.log(g,i,b),f(v)},c=>{console.error(c)});const u={width:"auto",height:"400px"},m={lat:t,lng:r};return o.exports.useEffect(()=>{"geolocation"in navigator?console.log("Available"):console.log("Not Available"),navigator.geolocation.getCurrentPosition(function(c){console.log("Latitude is :",c.coords.latitude),s(c.coords.latitude),console.log("Longitude is :",c.coords.longitude),d(c.coords.longitude)}),x.get("/discover").then(c=>{console.log("this is db Res for allListings",c),l(c.data)}).catch(c=>console.error(c))},[]),e("div",{children:n("div",{className:"container",children:[n("div",{className:"row",children:[n("div",{className:"col-4",children:[e("h1",{className:"text-center text-danger",children:"Discover"}),n("p",{children:["Offers near ",e("span",{style:{color:"slategrey"},children:h})]})]}),e("div",{className:"col-8",children:e(q,{googleMapsApiKey:"AIzaSyAWNUhMz1o6js88esl8_xmRkQgFOZr38nk",children:e(j,{mapContainerStyle:u,center:m,zoom:10})})})]}),e("div",{className:"row",children:e("div",{className:"col-12 d-inline-flex",children:a.map(c=>e(F,{listing:c}))})}),e("div",{className:"row",children:n("div",{className:"col-12",children:[e("h1",{className:"text-center text-danger",children:"Our approach"}),e("p",{children:"No-food-waste is an ecofriendly society that allows restaurant owners to sell their unsold stocks to you under the form of of nicely packaged meals."})]})})]})})},Me=()=>{const{isLoggedIn:t,currentUser:s}=_();return t?e(me,{}):(console.log("Hello I'm in private route live 11"),e(he,{to:"/login"}))};T.setApiKey("AIzaSyAWNUhMz1o6js88esl8_xmRkQgFOZr38nk");T.setLanguage("fr");const Ee=()=>{const[t,s]=o.exports.useState(0),[r,d]=o.exports.useState(0),[a,l]=o.exports.useState([]),[h,f]=o.exports.useState(""),[u,m]=o.exports.useState("list"),[c,v]=o.exports.useState([]),[g,i]=o.exports.useState(""),[b,N]=o.exports.useState([]),w={width:"auto",height:"100vh",className:"container-fluid"},H={lat:t,lng:r};T.fromLatLng(t,r).then(p=>{const k=p.results[0].formatted_address;for(let y=0;y<p.results[0].address_components.length;y++)for(let A=0;A<p.results[0].address_components[y].types.length;A++)switch(p.results[0].address_components[y].types[A]){case"locality":p.results[0].address_components[y].long_name;break;case"administrative_area_level_1":p.results[0].address_components[y].long_name;break;case"country":p.results[0].address_components[y].long_name;break}f(k)},p=>{console.error(p)}),o.exports.useEffect(()=>{navigator.geolocation.getCurrentPosition(function(p){console.log("Latitude is :",p.coords.latitude),s(p.coords.latitude),console.log("Longitude is :",p.coords.longitude),d(p.coords.longitude)}),R.get("/listings").then(p=>{console.log("this is the res from the db line 77",p),l(p.data.listings),N(p.data.categories)}).catch(p=>console.log(p))},[]),o.exports.useEffect(()=>{P()},[a]);const U=p=>new Promise(async(k,y)=>{try{let A=p.owner.address;const z=await T.fromAddress(A),{lat:K,lng:G}=z.results[0].geometry.location;console.log("lat long",K,G),k({lat:K,lng:G})}catch(A){y(A)}}),P=async()=>{console.log("waht is in listings ?",a);try{for(let p of a){const k=await U(p);console.log(">>",k),p.coord=k}}catch(p){console.error(p)}};console.log("listings, I hope they have the coordinates",a);const se=(p,k)=>{console.log("this is the handleClick for the marker",p,k);const y=a.find(A=>A._id===k);v(y),console.log(c)};return n("div",{className:"container",children:[e("div",{className:"row",children:n("div",{className:"col-12",children:[e("h1",{className:"text-center text-danger",children:"BROWSE"}),n("p",{children:["Offers near"," ",e("span",{style:{color:"slategrey"},children:h})]})]})}),e("div",{className:"row",children:e("div",{className:"col-12",children:n("form",{onSubmit:p=>{p.preventDefault();const k={search:g};R.post("/category",k).then(y=>{console.log("this is the response for the cat line 133",y.data.listings),l(y.data.listings)}).catch(y=>console.log(y))},children:[e("label",{htmlFor:"search"}),b.map((p,k)=>e("button",{className:"btn btn-active m-2 p-3",value:p._id,onClick:y=>i(y.target.value),style:{backgroundColor:p.color},children:p.name},p._id))]})})}),n("div",{className:"row",children:[e("div",{className:"col-6",children:e("button",{className:"btn-info",value:"list",onClick:p=>m(p.target.value),children:"LIST"})}),e("div",{className:"col-6",children:e("button",{className:"btn-info",value:"map",onClick:p=>m(p.target.value),children:"MAP"})})]}),n("div",{className:"row",children:[u==="list"&&e("div",{className:"col-12 d-flex justify-content-center",children:a.map(p=>e("div",{children:e(F,{listing:p})},p._id))}),u==="map"&&e("div",{className:"col-12 d-inline-grid justify-content-center",children:n("div",{className:"row",children:[e("div",{className:"col-8",children:e(q,{googleMapsApiKey:"AIzaSyAWNUhMz1o6js88esl8_xmRkQgFOZr38nk",children:e(j,{mapContainerStyle:w,center:H,zoom:10,children:a.map((p,k)=>{var y,A;return n("form",{children:[e("label",{htmlFor:p.name}),e(pe,{position:{lat:((y=p.coord)==null?void 0:y.lat)||-34.397,lng:((A=p.coord)==null?void 0:A.lng)||150.644},onClick:z=>se(z,p._id)})]},k)})})})}),e("div",{className:"col-4",children:Object.entries(c).length>0>0&&e(F,{listing:c})})]})})]})]})},Oe=()=>{const{currentUser:t}=_(),s=L(),r=o.exports.useRef(),[d,a]=o.exports.useState([]),[l,h]=o.exports.useState(0),[f,u]=o.exports.useState("");console.log("log line 10");const{id:m}=Q();console.log("this is the id from the params on the front line 13",m),o.exports.useEffect(()=>{x.get("/listing/"+m).then(g=>{console.log("this is the relevant listing on the front",g.data),a(g.data)}).catch(g=>console.log("here err",g))},[]);const c=()=>{r.current.classList.toggle("collapse")},v=g=>{g.preventDefault(),console.log("this is the qty and payment",l,f),console.log("this is the current user",t);const i={quantity:l,payment:f,listing:d._id,buyer:t._id};x.post(`/listing/${m}`,i).then(b=>{console.log(b.data),s(`/account/bookings/${b.data._id}`)}).catch(b=>console.log(b))};return e(S,{children:e("div",{className:"container",children:n("div",{className:"row",children:[n("div",{className:"col-6",children:[e("h1",{children:"Listing details"}),d.name&&e(F,{listing:d})]}),n("div",{className:"col-6",children:[e("button",{onClick:c,className:"btn btn-primary px-5 py-2",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseExample","aria-expanded":"false","aria-controls":"collapseExample",children:"BOOK THIS MEAL"}),e("div",{className:"collapse",id:"collapseExample",ref:r,children:e("div",{className:"card card-body",children:n("form",{onSubmit:v,className:"p-4",children:[e("div",{className:"form-group m-3",children:e("label",{htmlFor:"label",className:"card-title",children:"Quantity"})}),e("div",{className:"form-group m-3",children:e("input",{type:"number",id:"label",min:"1",max:d.availableQuantity,onChange:g=>h(g.target.value)})}),e("div",{className:"form-group m-3",children:e("label",{htmlFor:"payment",children:"PAYMENT"})}),e("div",{className:"form-group m-3",children:n("select",{id:"payment",onChange:g=>u(g.target.value),children:[e("option",{id:"VISA",children:"VISA"}),e("option",{id:"MASTERCARD",children:"MASTERCARD"}),e("option",{id:"PAYPAL",children:"PAYPAL"})]})}),e("button",{className:"btn btn-primary px-5 py-2",children:"CONCLUDE BOOKING"})]})})})]})]})})})},Ue=()=>{const[t,s]=o.exports.useState(""),[r,d]=o.exports.useState(""),[a,l]=o.exports.useState(""),[h,f]=o.exports.useState(""),[u,m]=o.exports.useState(!0),c=L(),{businessId:v}=ge().state,g=i=>{i.preventDefault(),x.post(`/api/listings/${v}/create`,{name:t,price:r,availableQuantity:a,description:h,recurring:u}).then(b=>{console.log("This is dbRes from line 15 of CreatingList",b),c("/dashboard")}).catch(b=>console.error(b))};return n("form",{className:"p-4",children:[e("h2",{className:"mx-3",children:"Your listing's info"}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"text",name:"name",placeholder:"Name of your listing",onChange:i=>s(i.target.value)})}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"number",name:"price",placeholder:"How much?",onChange:i=>d(i.target.value)})}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"number",name:"availableQuantity",placeholder:"How many?",onChange:i=>l(i.target.value)})}),e("div",{className:"form-group m-3",children:e("textarea",{className:"form-control",type:"text",name:"description",placeholder:"Please provide a short description",onChange:i=>f(i.target.value)})}),n("div",{className:"m-3",children:[e("h3",{children:"Is the listing reccuring?"}),e("label",{className:"mx-4",htmlFor:"recurring",children:"Yes"}),e("input",{type:"radio",idfor:"recurring",name:"recurring",value:!0,checked:u===!0,onChange:i=>m(i.target.value&&!0)}),e("label",{className:"mx-4",htmlFor:"recurring",children:"No"}),e("input",{type:"radio",idfor:"recurring",name:"recurring",checked:u===!1,value:!1,onChange:i=>m(i.target.value&&!1)})]}),e("button",{className:"btn btn-primary px-5 py-2",onClick:i=>g(i),children:"Create a new listing"})]})},Pe=()=>{const[t,s]=o.exports.useState(""),[r,d]=o.exports.useState(""),[a,l]=o.exports.useState(""),[h,f]=o.exports.useState(""),[u,m]=o.exports.useState(""),c=L(),{listingId:v}=Q();o.exports.useEffect(()=>{x.get(`/api/listings/${v}`).then(i=>{s(i.data.name),d(i.data.price),l(i.data.availableQuantity),f(i.data.description),m(i.data.recurring)}).catch(i=>console.error(i))},[v]);const g=i=>{i.preventDefault(),x.patch(`/api/listings/modify/${v}`,{name:t,price:r,availableQuantity:a,description:h,recurring:u}).then(()=>{c("/dashboard")}).catch(b=>console.error(b))};return n("form",{className:"p-4",onSubmit:i=>g(i),children:[e("h2",{className:"mx-3",children:"Your listing's info"}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"text",name:"name",id:"name",value:t,onChange:i=>s(i.target.value)})}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"number",name:"price",id:"price",value:r,onChange:i=>d(i.target.value)})}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"number",name:"availableQuantity",id:"availableQuantity",value:a,onChange:i=>l(i.target.value)})}),e("div",{className:"form-group m-3",children:e("textarea",{className:"form-control",type:"text",name:"description",id:"description",value:h,onChange:i=>f(i.target.value)})}),n("div",{className:"m-3",children:[e("h3",{children:"Is the listing reccuring?"}),e("label",{className:"mx-4",htmlFor:"recurring",children:"Yes"}),e("input",{type:"radio",idfor:"recurring",name:"recurring",id:"recurring",value:!0,checked:u===!0,onChange:i=>m(i.target.checked&&!0)}),e("label",{className:"mx-4",htmlFor:"recurring",children:"No"}),e("input",{type:"radio",idfor:"recurring",name:"recurring",id:"recurring",value:!0,checked:u===!1,onChange:i=>m(i.target.value&&!1)})]}),e("button",{className:"btn btn-primary px-5 py-2",children:"Modify the listing"})]})},Re=({booking:t})=>{var d,a,l,h,f,u,m;const s=L(),r=c=>{c.preventDefault(),x.delete(`/account/bookings/delete/${t._id}/${t.quantity}`).then(v=>{console.log(v.data),s("/account")}).catch(v=>console.log(v))};return e(S,{children:n("div",{className:"card",style:{width:"30rem"},children:[e("img",{className:"card-img-top",src:(a=(d=t.listing)==null?void 0:d.owner)==null?void 0:a.picture,alt:(l=t.listing)==null?void 0:l.name}),n("div",{className:"card-body",children:[n("h5",{className:"card-title",children:["Reserved quantity : ",t.quantity]}),n("h5",{className:"card-text",children:["Price: ",((h=t.listing)==null?void 0:h.price)*t.quantity,"\u20AC"]}),e("p",{className:"card-text",children:(u=(f=t.listing)==null?void 0:f.owner)==null?void 0:u.address}),n("p",{className:"card-text",children:["Pick up by ",$((m=t.listing.owner)==null?void 0:m.endTimeSlot).format("ddd, hA")]}),e("form",{onSubmit:r,children:e("button",{children:"Cancel booking"})})]})]})})},Fe=()=>{const[t,s]=o.exports.useState({}),[r,d]=o.exports.useState([]);return o.exports.useEffect(()=>{x.get("/account").then(a=>{console.log(a.data),s(a.data)}).catch(a=>console.log(a))},[]),o.exports.useEffect(()=>{x.get("/api/business/my-business").then(a=>{a.data[0].listings.forEach(l=>x.get(`/my-booking/${l}`).then(h=>{d(f=>{const u=[...f];return u.push(...h.data),u})}).catch(h=>console.error(h)))}).catch(a=>console.error(a))},[]),n(S,{children:[n("h1",{children:["Welcome ",t.name]}),t.role==="user"&&n(S,{children:[e("h3",{children:"My Bookings"}),!t.bookings&&e("p",{children:"You don't have any bookings for the moment"}),t.bookings&&t.bookings.length>0&&t.bookings.map(a=>{var l,h,f,u,m,c,v;return e(S,{children:n("div",{className:"card",style:{width:"auto"},children:[e("img",{className:"card-img-top",src:(h=(l=a.listing)==null?void 0:l.owner)==null?void 0:h.picture,alt:(f=a.listing)==null?void 0:f.name}),n("div",{className:"card-body",children:[n("h5",{className:"card-title",children:["Reserved quantity : ",a.quantity]}),n("h5",{className:"card-text",children:["Price: ",((u=a.listing)==null?void 0:u.price)*a.quantity,"\u20AC"]}),e("p",{className:"card-text",children:(c=(m=a.listing)==null?void 0:m.owner)==null?void 0:c.address}),n("p",{className:"card-text",children:["Pick up by ",$((v=a.listing.owner)==null?void 0:v.endTimeSlot).format("ddd, hA")]}),e(ee,{to:`/account/bookings/${a._id}`,children:"See this booking"})]})]})})})]}),t.role==="business"&&n(S,{children:[e("h3",{children:"My Bookings"}),!r&&e("p",{children:"You don't have any bookings for the moment"}),r&&n(S,{children:[e("p",{children:"Here are your bookings"}),e("div",{className:"d-flex column",children:r.map(a=>n("div",{children:[e("h3",{children:a.buyer.name}),e("p",{children:a.listing.name}),e("p",{children:a.quantity})]}))})]})]})]})};T.setApiKey("AIzaSyAWNUhMz1o6js88esl8_xmRkQgFOZr38nk");T.setLanguage("fr");const He=()=>{var u,m,c,v,g;const{id:t}=Q();L();const[s,r]=o.exports.useState(null),[d,a]=o.exports.useState({}),l={width:"auto",height:"100vh",className:"container-fluid"};o.exports.useEffect(()=>{x.get(`/account/bookings/${t}`).then(i=>{console.log(i.data),r(i.data)}).catch(i=>console.log(i))},[t]),o.exports.useEffect(()=>{s!==null&&f()},[s]);const h=i=>new Promise(async(b,N)=>{try{let w=i.listing.owner.address;const H=await T.fromAddress(w),{lat:U,lng:P}=H.results[0].geometry.location;console.log("lat long",U,P),b({lat:U,lng:P})}catch(w){N(w)}}),f=async()=>{try{const i=await h(s);console.log(">>",i),a(i),console.log("this is the booking with the coordinates",s),console.log("this is lat and long",d)}catch(i){console.error(i)}};return console.log("booking",s),s&&((u=s==null?void 0:s.listing)==null?void 0:u.coord)&&console.log({lat:Number((c=(m=s==null?void 0:s.listing)==null?void 0:m.coord)==null?void 0:c.lat),lng:Number((g=(v=s==null?void 0:s.listing)==null?void 0:v.coord)==null?void 0:g.lng)}),e("div",{className:"container",children:s&&n("div",{className:"row",children:[e("div",{className:"col-6",children:e(Re,{booking:s})}),e("div",{className:"col-6",children:e(q,{googleMapsApiKey:"AIzaSyAWNUhMz1o6js88esl8_xmRkQgFOZr38nk",children:e(j,{mapContainerStyle:l,center:{lat:(d==null?void 0:d.lat)||45,lng:(d==null?void 0:d.lng)||50},zoom:20})})})]})})},ze=()=>{const t=o.exports.useRef(),[s,r]=o.exports.useState([]);o.exports.useEffect(()=>{x.get("/favorites").then(a=>r(a.data.favorites)).catch(a=>console.log(a))},[]);const d=()=>{t.current.classList.toggle("collapse")};return n(S,{children:[e("h3",{className:"text-danger text-uppercase",children:"Your favorite restaurants"}),e("div",{className:"container",children:n("div",{className:"row",children:[e("div",{className:"col-6",children:s.map(a=>e(S,{children:n("div",{className:"card",style:{width:"30rem"},children:[e("img",{className:"card-img-top",src:a.picture,alt:a.name}),n("div",{className:"card-body",children:[e("h5",{className:"card-title",children:a.name}),e("p",{className:"card-text",children:a.description})]})]})}))}),n("div",{className:"col-6",children:[e("p",{children:e("button",{onClick:d,className:"btn btn-primary px-5 py-2",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseExample","aria-expanded":"false","aria-controls":"collapseExample",children:"LEAVE A COMMENT FOR THIS BUSINESS"})}),e("div",{className:"collapse",id:"collapseExample",ref:t,children:e("div",{className:"card card-body",children:n("form",{className:"p-4",children:[n("div",{className:"form-group m-3",children:[e("label",{htmlFor:"comment",className:"card-title"}),e("input",{type:"text",id:"comment",min:"1",className:"form-control-file"})]}),e("button",{className:"btn btn-primary px-5 py-2",children:"POST COMMENT"})]})})})]})]})})]})};function Be(){const[t,s]=o.exports.useState("user");return n("div",{className:"App",children:[e(xe,{}),n(fe,{children:[e(C,{path:"/",element:e(Se,{setRole:s})}),e(C,{path:"/signup",element:e(ke,{role:t})}),e(C,{path:"/login",element:e(we,{role:t})}),n(C,{element:e(Me,{}),children:[e(C,{path:"/discover",element:e(De,{})}),e(C,{path:"/account",element:e(Fe,{})}),e(C,{path:"/account/bookings/:id",element:e(He,{})}),e(C,{path:"/dashboard",element:e(_e,{})}),e(C,{path:"/onboarding",element:e(Te,{})}),e(C,{path:"/listings/create",element:e(Ue,{})}),e(C,{path:"/listings/:listingId/update",element:e(Pe,{})}),e(C,{path:"/favorites",element:e(ze,{})})]}),e(C,{path:"/listings",element:e(Ee,{})}),e(C,{path:"/listing/:id",element:e(Oe,{})})]})]})}const $e=({children:t})=>{const[s,r]=o.exports.useState({currentUser:null,isLoading:!0,isLoggedIn:!1});o.exports.useEffect(()=>{d()},[]);const d=()=>{const u=localStorage.getItem("authToken");u?R.isLoggedIn(u).then(m=>{console.log(m),r({currentUser:m,isLoading:!1,isLoggedIn:!0})}).catch(m=>{r({currentUser:null,isLoading:!1,isLoggedIn:!1})}):r({currentUser:null,isLoading:!1,isLoggedIn:!1})},a=()=>{l(),d()},l=()=>{localStorage.removeItem("authToken")},h=u=>{localStorage.setItem("authToken",u),d()},f={currentUser:s.currentUser,isLoading:s.isLoading,isLoggedIn:s.isLoggedIn,removeUser:a,storeToken:h,authenticateUser:d};return e(te.Provider,{value:f,children:t})};ve.render(e(Ne.StrictMode,{children:e(ye,{children:e($e,{children:e(Be,{})})})}),document.getElementById("root"));
