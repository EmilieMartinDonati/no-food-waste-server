var le=Object.defineProperty,ie=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var J=(t,s,r)=>s in t?le(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,M=(t,s)=>{for(var r in s||(s={}))de.call(s,r)&&J(t,r,s[r]);if(Z)for(var r of Z(s))ue.call(s,r)&&J(t,r,s[r]);return t},O=(t,s)=>ie(t,ce(s));import{r as l,u as L,j as a,F as S,a as e,N as D,b as X,K as he,T as ee,X as me,C as pe,f as te,c as ge,d as fe,h as z,L as se,G as T,e as $,g as j,i as ve,O as ye,M as ae,k as Q,_ as be,l as Ne,S as xe,R as we,m as C,n as Se,o as ke,B as Ce}from"./vendor.807a7687.js";const Fe=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}};Fe();const ne=l.exports.createContext(),E=()=>l.exports.useContext(ne),Ae=()=>{const{isLoggedIn:t,currentUser:s,removeUser:r}=E(),o=L(),n=()=>{r(),o("/")};return a("nav",{className:"navbar navbar-secondary px-5 py-4 text-uppercase",style:{backgroundColor:"#FF4646"},children:[!t&&a(S,{children:[e(D,{className:"topLink",to:"/",children:"Home"}),e(D,{className:"topLink",to:"/login",children:"Log in"}),e(D,{className:"topLink",to:"/signup",children:"Sign up"})]}),t&&a(S,{children:[s.role==="user"&&a(S,{children:[e(D,{className:"topLink",to:"/listings",children:"Search"}),e(D,{className:"topLink",to:"/favorites",children:"Favorites"})]}),s.role==="business"&&e(D,{className:"topLink",to:"/dashboard",children:"Dashboard"}),e(D,{className:"topLink",to:"/account",children:"My account"}),e("button",{className:"btn btn-secondary",onClick:n,style:{backgroundColor:"#FFB396",border:0,color:"red"},children:"Log out"})]})]})},Le=({setRole:t})=>{const{isLoggedIn:s,currentUser:r}=E(),o=L();return a("div",{children:[!s&&e("div",{id:"cover-image-auth-role",children:a("div",{className:"d-flex-wrap row align-items-center",style:{height:"100%"},children:[e("h1",{style:{"font-size":"7rem",color:"white"},children:"How will you help us stop wasting food?"}),a("div",{children:[e("button",{className:"btn btn-primary mx-4 px-5",style:{backgroundColor:"#FF4646",border:0},onClick:()=>{t("user"),o("/signup")},children:"I will buy food"}),e("button",{className:"btn btn-primary mx-4 px-5",style:{backgroundColor:"#FF4646",border:0},onClick:()=>{t("business"),o("/signup")},children:"I will sell food"})]})]})}),s&&r.role==="user"&&o("/discover"),s&&r.role==="business"&&o("/dashboard")]})},P=X.create({baseURL:"https://no-food-waste-2911.herokuapp.com",withCredentials:!0});P.interceptors.request.use(t=>{const s=localStorage.getItem("authToken");return t.headers.Authorization=s?`Bearer ${s}`:"",t});//! Error handling to use in the catch
function Y(t){var s,r;throw((s=t.response)==null?void 0:s.data)&&console.log(t.response&&((r=t.response)==null?void 0:r.data)),t}const w=O(M({},P),{signup(t){return P.post("/api/auth/signup",t).then(s=>{console.log(s)}).catch(Y)},isLoggedIn(t){return P.get("/api/auth/me",{headers:{Authorization:`Bearer ${t}`}}).then(s=>s.data).catch(Y)},signin(t){return P.post("/api/auth/signin",t).then(s=>s.data).catch(Y)}}),Ie=({role:t})=>{const[s,r]=l.exports.useState(""),[o,n]=l.exports.useState(""),i=L(),{storeToken:m,authenticateUser:v,currentUser:u}=E();return console.log("This is current user",u),a(S,{children:[e("h1",{className:"pt-5",children:"Sign in"}),a("form",{className:"pb-5",onSubmit:c=>{const f={email:s,password:o};console.log("data in AuthSignin line 20",f),c.preventDefault(),w.signin(f).then(y=>{m(y.authToken),v(),u.role==="user"?i("/discover"):i("/dashboard")}).catch(y=>console.log(y))},children:[a("div",{className:"form-group p-5",children:[e("label",{className:"m-3",htmlFor:"email",children:"EMAIL"}),e("input",{className:"form-control",type:"text",name:"email",required:!0,onChange:c=>r(c.target.value)}),e("label",{className:"m-3",htmlFor:"password",children:"PASSWORD"}),e("input",{className:"form-control",type:"password",name:"password",required:!0,onChange:c=>n(c.target.value)})]}),e("button",{className:"btn btn-primary px-5 py-2",style:{backgroundColor:"#FF4646",border:0},children:"LOG IN"})]})]})},U=X.create({baseURL:"https://no-food-waste-2911.herokuapp.com",withCredentials:!0});U.interceptors.request.use(t=>{const s=localStorage.getItem("authToken");return t.headers.Authorization=s?`Bearer ${s}`:"",t});//! Error handling to use in the catch
function W(t){var s,r;throw((s=t.response)==null?void 0:s.data)&&console.log(t.response&&((r=t.response)==null?void 0:r.data)),t}const B=O(M({},U),{signup(t){return U.post("/api/auth/signup",t).then(s=>{console.log(s)}).catch(W)},isLoggedIn(t){return U.get("/api/auth/me",{headers:{Authorization:`Bearer ${t}`}}).then(s=>s.data).catch(W)},signin(t){return U.post("/api/auth/signin",t).then(s=>s.data).catch(W)}}),Te=({role:t})=>{const[s,r]=l.exports.useState({name:"",email:"",password:"",role:t});console.log(s);const o=L();return a(S,{children:[e("h2",{className:"pt-5",children:"Create an account"}),a("form",{onSubmit:m=>{m.preventDefault(),console.log("during the handleSubmit",s),B.signup(s).then(v=>{console.log("This is coming back from the server !",v),o("/login")}).catch(v=>{console.log("THIS IS THE ERROR",v)})},onChange:m=>{r(v=>O(M({},v),{[m.target.id]:m.target.value})),console.log("after the handleChange",s)},className:"pb-5",children:[a("div",{className:"form-group p-5",children:[e("label",{className:"m-3",htmlFor:"name",children:"NAME"}),e("input",{className:"form-control",type:"text",id:"name",required:!0}),e("label",{className:"m-3",htmlFor:"email",children:"EMAIL"}),e("input",{className:"form-control",type:"text",id:"email",required:!0}),e("label",{className:"m-3",htmlFor:"password",children:"PASSWORD"}),e("input",{className:"form-control",type:"password",id:"password",required:!0})]}),e("button",{className:"btn btn-primary px-5 py-2",style:{backgroundColor:"#FF4646",border:0},children:"SIGN UP"})]}),e(D,{to:"/login",role:t,children:e("h3",{children:"Already registered ? Log in"})})]})},_e=({setBusiness:t,setStep:s})=>{const[r,o]=l.exports.useState(""),[n,i]=l.exports.useState(""),[m,v]=l.exports.useState(""),[u,g]=l.exports.useState(""),c=l.exports.useRef(""),f=y=>{y.preventDefault(),t(d=>O(M({},d),{name:r,address:n,phone:m,description:u,picture:c.current.files[0]})),s(2)};return a("form",{className:"p-4",children:[e("h2",{children:"Describe your business"}),e("p",{children:"Please tell us a little bit more about your business so that we can settle your account"}),e("h3",{children:"Confirm the name and location of your business"}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"text",name:"name",placeholder:"Name of your business",onChange:y=>o(y.target.value)})}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"text",name:"address",placeholder:"Address of your business",onChange:y=>i(y.target.value)})}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"number",name:"phone",placeholder:"Phone number",onChange:y=>v(Number(y.target.value))})}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"text",name:"description",placeholder:"Give us a quick description of your business",onChange:y=>g(y.target.value)})}),e("p",{children:"You can also provide a picture for your business. While not mandatory, it will help users differentiating your listings with others."}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control-file",ref:c,type:"file",name:"picture"})}),e("button",{className:"btn btn-primary px-5 py-2",onClick:y=>f(y),children:"Register"})]})},De=({setBusiness:t,setStep:s})=>{const[r,o]=l.exports.useState([]),[n,i]=l.exports.useState([]);l.exports.useEffect(()=>{w.get("/api/category").then(u=>o(u.data)).catch(u=>console.error(u))},[]);const m=u=>{const g=[],c=u.target.selectedOptions;for(let f=0;f<c.length;f++)g.push(c[f].value);i(g)},v=u=>{u.preventDefault(),t(g=>O(M({},g),{tags:n})),s(3)};return a("form",{className:"p-4",children:[e("h2",{children:"Describe the products you sell"}),e("p",{children:"Tell us what kind of products you will be selling. This information will appear in the app."}),e("h3",{children:"Which tags best describe your business and products?"}),e("div",{className:"dropdown m-3",children:e("select",{type:"text",name:"tags",placeholder:"Select all relevant tags",onChange:u=>m(u),multiple:!0,children:r&&r.map(u=>e("option",{className:"dropdown-item",value:u._id,children:u.name}))})}),e("button",{className:"btn btn-primary",onClick:u=>v(u),children:"Ok"})]})},Ee=({business:t})=>{const[s,r]=l.exports.useState(null),[o,n]=l.exports.useState(null),i=L(),m=g=>{r(new Date(g.target.value))},v=g=>{n(new Date(g.target.value))},u=g=>{g.preventDefault();const c=new FormData;c.append("name",t.name),c.append("address",t.address),c.append("phone",t.phone),c.append("description",t.description),c.append("picture",t.picture),c.append("tags",t.tags),c.append("startTimeSlot",s),c.append("endTimeSlot",o),w.post("/api/business/create",c).then(()=>{console.log("Hey, do you arrive here??????"),i("/dashboard")}).catch(f=>console.error(f))};return a("form",{className:"p-4",children:[e("h2",{children:"At what time can users pick up their order?"}),e("p",{children:"Set your timeslots below for pickup. Note that the majority of our partners set this timeslot between 15 to 30 minutes before closing."}),e("label",{htmlFor:"startTime"}),e("input",{className:"m-3",type:"datetime-local",id:"startTime",onChange:g=>m(g)}),e("label",{htmlFor:"endTime"}),e("input",{className:"m-3",type:"datetime-local",id:"endTime",onChange:g=>v(g)}),e("button",{className:"btn btn-primary",onClick:g=>u(g),children:"Register timeslots"})]})},Me=()=>{const[t,s]=l.exports.useState(1),[r,o]=l.exports.useState({owner:"",name:"",phone:"",address:"",description:"",picture:"",listings:[],tags:[],timeSlots:[]});return a("div",{className:"background",children:[e(S,{children:"Hello"}),t===1&&e(_e,{setBusiness:o,setStep:s}),t===2&&e(De,{setBusiness:o,setStep:s}),t===3&&e(Ee,{business:r})]})},Oe=({business:t,setBusiness:s})=>{const r=L(),o=i=>{r(`/listings/${i}/update`)},n=i=>{w.delete(`/api/listings/${t._id}/delete/${i}`).then(m=>{s(m.data)}).catch(m=>console.error(m))};return a("div",{className:"background",children:[e("img",{style:{width:"100vw",maxHeight:"400px"},src:t.picture,alt:t.name}),e("h1",{className:"p-5",style:{color:"#FF4646  "},children:t.name}),!t.listings.length&&e("p",{children:"You don't have any listings for the moment"}),t.listings.length>0&&a(S,{children:[e("h2",{className:"p-3",children:"My listings"}),a("div",{className:"col-12 container m-5",children:[a("div",{className:"col-12 row",children:[e("strong",{className:"col-sm p-4",children:"Name"}),e("strong",{className:"col-sm p-4",children:"Price"}),e("strong",{className:"col-sm p-4",children:"Available quantity"}),e("strong",{className:"col-sm p-4",children:"Description"}),e("strong",{className:"col-sm p-4",children:"Modify"}),e("strong",{className:"col-sm p-4",children:"Delete"}),e("strong",{className:"col-sm p-4",children:"Active"})]}),e("hr",{}),t.listings.map(i=>a("div",{className:i.archived?"col-12 row gray-listing":"col-12 row",children:[e("span",{className:"col-sm p-4",children:i.name}),a("span",{className:"col-sm p-4",children:[i.price," \u20AC"]}),e("span",{className:"col-sm p-4",children:i.availableQuantity}),e("span",{className:"col-sm p-4",children:i.description}),e("span",{style:{cursor:"pointer"},onClick:()=>o(i._id),className:"col-sm p-4",children:e(he,{size:24})}),e("span",{style:{cursor:"pointer"},onClick:()=>n(i._id),className:"col-sm p-4",children:e(ee,{size:24})}),a("span",{style:{color:i.archived?"red":"green"},className:"col-sm p-4",children:[i.archived&&e(me,{size:24}),!i.archived&&e(pe,{size:24})]})]},i._id))]})]}),e("button",{className:"btn btn-primary px-5 py-2",style:{backgroundColor:"#FF4646",border:0},onClick:()=>r("/listings/create",{state:{businessId:t._id}}),children:"Add a listing"})]})},Re=()=>{const{currentUser:t}=E(),[s,r]=l.exports.useState(""),o=L();return l.exports.useEffect(()=>{w.get("/api/business").then(n=>n.data.find(i=>i.owner===t._id)).then(n=>r(n)).catch(n=>console.error(n))},[]),a("div",{className:"background",children:[!s&&a("div",{children:[e("p",{className:"p-5",children:"Vous n'avez pas encore de business enregistr\xE9"}),e("button",{className:"btn btn-primary py-2 px-5",style:{backgroundColor:"#FF4646",border:0},onClick:()=>o("/onboarding"),children:"New business"})]}),s&&e(Oe,{business:s,setBusiness:r})]})},H=({listing:t})=>{var y,d,b;const[s,r]=l.exports.useState(te),[o,n]=l.exports.useState(""),[i,m]=l.exports.useState(""),{currentUser:v,storeToken:u}=E();l.exports.useEffect(()=>{var N,p;((p=v.favorites)==null?void 0:p.includes((N=t==null?void 0:t.owner)==null?void 0:N._id))?r(ge):r(te)},[v]),l.exports.useEffect(()=>{const N=setInterval(()=>{c()},1e3);return()=>clearInterval(N)},[]);const g=(N,p)=>Math.round(Math.abs(N-p)/1e3/60),c=()=>{new Date().getHours()<new Date(t.owner.startTimeSlot).getHours()?(n("Will open soon"),m("green")):new Date().getHours()>new Date(t.owner.endTimeSlot).getHours()?(n("Come back tomorrow"),m("black")):g(new Date(t.owner.endTimeSlot).getHours(),new Date().getHours())<60?(n("Will close soon"),m("red")):new Date().getHours()===new Date(t.owner.endTimeSlot)&&(new Date().getMinutes()<new Date(t.owner.startTimeSlot).getMinutes()?(n("Will open in less than an hour"),m("green")):new Date().getMinutes()>new Date(t.owner.endTimeSlot).getMinutes()?(n("You just missed it ... Come back tomorrow!"),m("black")):g(new Date(t.owner.endTimeSlot).getMinutes(),new Date().getMinutes())<60&&(n("Will close in less than an hour"),m("red")))},f=()=>{w.patch(`/account/favorites/${t.owner._id}`).then(N=>{u(N.data)}).catch(N=>console.error(N))};return a("div",{className:"card my-3 p-3 mx-5",style:{width:"325px",borderRadius:"10px",borderShadow:"10px",backgroundColor:"#FFB396"},children:[a("div",{style:{position:"relative"},children:[e("img",{className:"card-img-top",style:{height:200},src:(y=t.owner)==null?void 0:y.picture,alt:t.name}),e("p",{style:{backgroundColor:i,position:"absolute",top:"10px",left:"10px",color:"white",borderRadius:"5px",padding:"2%"},children:o})]}),a("div",{className:"card-body text-uppercase text-justify text-dark",children:[e("div",{className:"row",children:e("div",{className:"col-12",children:e("h4",{className:"card-title",children:t.name})})}),a("div",{className:"row",children:[e("div",{className:"col-8",children:e("h6",{className:"card-text text-dark",children:(d=t.owner)==null?void 0:d.name})}),e("div",{className:"col-4",children:a("h5",{className:"card-text",style:{color:"black"},children:[t.price,"\u20AC"]})}),e("div",{style:{position:"absolute",top:"30px",left:"120px"},children:e(fe,{style:{cursor:"pointer",color:"#FF4646"},onClick:f,icon:s,size:"xl"})})]}),e("hr",{style:{color:"#FF4646",height:"1px"}}),a("p",{className:"card-text text-dark",children:["Pick up by"," ",e("span",{className:"text-danger text-xl",children:z((b=t.owner)==null?void 0:b.endTimeSlot).format("ddd, hA")})]}),a("p",{children:["Available quantity : ",t.availableQuantity]}),e(se,{to:`/listing/${t._id}`,children:"SEE"})]})]})};T.setApiKey("AIzaSyAWNUhMz1o6js88esl8_xmRkQgFOZr38nk");T.setLanguage("fr");const Pe=()=>{const[t,s]=l.exports.useState(0),[r,o]=l.exports.useState(0),[n,i]=l.exports.useState([]),[m,v]=l.exports.useState("");T.fromLatLng(t,r).then(c=>{const f=c.results[0].formatted_address;let y,d,b;for(let N=0;N<c.results[0].address_components.length;N++)for(let p=0;p<c.results[0].address_components[N].types.length;p++)switch(c.results[0].address_components[N].types[p]){case"locality":y=c.results[0].address_components[N].long_name;break;case"administrative_area_level_1":d=c.results[0].address_components[N].long_name;break;case"country":b=c.results[0].address_components[N].long_name;break}console.log(y,d,b),v(f)},c=>{console.error(c)});const u={width:"100vw",height:"60vh"},g={lat:t,lng:r};return l.exports.useEffect(()=>{"geolocation"in navigator?console.log("Available"):console.log("Not Available"),navigator.geolocation.getCurrentPosition(function(c){console.log("Latitude is :",c.coords.latitude),s(c.coords.latitude),console.log("Longitude is :",c.coords.longitude),o(c.coords.longitude)}),w.get("/discover").then(c=>{console.log("this is db Res for allListings",c),i(c.data)}).catch(c=>console.error(c))},[]),e("div",{children:a("div",{className:"background",children:[a("div",{children:[a("div",{className:"p-5",children:[e("h1",{className:"text-center text-danger",children:"Discover"}),a("p",{children:["Offers near ",e("span",{style:{color:"slategrey"},children:m})]})]}),e("div",{className:"pb-5",style:{width:"80vw"},children:e($,{googleMapsApiKey:"AIzaSyAWNUhMz1o6js88esl8_xmRkQgFOZr38nk",children:e(j,{mapContainerStyle:u,center:g,zoom:10})})})]}),e("div",{className:"d-flex-wrap justify-content-center",children:e("div",{id:"listing-card-div-flex",children:n.map(c=>{if(!c.archived)return e(H,{listing:c})})})}),e("div",{className:"row",children:a("div",{className:"col-12",children:[e("h1",{className:"text-center text-danger p-5",children:"Our approach"}),e("p",{className:"pb-5",children:"No-food-waste is an ecofriendly society that allows restaurant owners to sell their unsold stocks to you under the form of of nicely packaged meals."})]})})]})})},Ue=()=>{const{isLoggedIn:t,currentUser:s}=E();return t?e(ye,{}):(console.log("Hello I'm in private route live 11"),e(ve,{to:"/login"}))};T.setApiKey("AIzaSyAWNUhMz1o6js88esl8_xmRkQgFOZr38nk");T.setLanguage("fr");const Be=()=>{const[t,s]=l.exports.useState(0),[r,o]=l.exports.useState(0),[n,i]=l.exports.useState([]),[m,v]=l.exports.useState(""),[u,g]=l.exports.useState("list"),[c,f]=l.exports.useState([]),[y,d]=l.exports.useState([]),[b,N]=l.exports.useState(""),[p,F]=l.exports.useState([]),I={width:"60vw",height:"60vh",className:"container-fluid"},_={lat:t,lng:r};T.fromLatLng(t,r).then(h=>{const k=h.results[0].formatted_address;for(let x=0;x<h.results[0].address_components.length;x++)for(let A=0;A<h.results[0].address_components[x].types.length;A++)switch(h.results[0].address_components[x].types[A]){case"locality":h.results[0].address_components[x].long_name;break;case"administrative_area_level_1":h.results[0].address_components[x].long_name;break;case"country":h.results[0].address_components[x].long_name;break}v(k)},h=>{console.error(h)}),l.exports.useEffect(()=>{navigator.geolocation.getCurrentPosition(function(h){console.log("Latitude is :",h.coords.latitude),s(h.coords.latitude),console.log("Longitude is :",h.coords.longitude),o(h.coords.longitude)}),B.get("/listings").then(h=>{console.log("this is the res from the db line 77",h.data.businesses),i(h.data.listings),F(h.data.categories),d(h.data.businesses)}).catch(h=>console.log(h))},[]);const G=()=>{try{B.get("/listings").then(h=>{console.log("this is the res from the db line 77",h.data.businesses),i(h.data.listings)})}catch(h){next(h)}};l.exports.useEffect(()=>{re()},[n]);const q=h=>new Promise(async(k,x)=>{try{let A=h.owner.address;const R=await T.fromAddress(A),{lat:K,lng:V}=R.results[0].geometry.location;console.log("lat long",K,V),k({lat:K,lng:V})}catch(A){x(A)}}),re=async()=>{console.log("waht is in listings ?",n);try{for(let h of n){const k=await q(h);console.log(">>",k),h.coord=k}}catch(h){console.error(h)}};console.log("listings, I hope they have the coordinates",n);const oe=(h,k,x)=>{console.log("this is the handleClick for the marker",h,k),console.log(x);const A=y.find(R=>R._id===x);console.log(y),console.log(A),f(A.listings),console.log("those are the listings",c)};return a("div",{className:"container-fluid pt-3 background",children:[e("div",{className:"row",children:a("div",{className:"col-12",children:[e("h1",{className:"text-center text-bold p-5",style:{color:"#FF4646"},children:"Find all our listings"}),a("p",{children:["Offers near"," ",e("span",{style:{color:"slategrey"},children:m})]})]})}),e("div",{className:"row",children:e("div",{className:"col-12",children:a("form",{onSubmit:h=>{h.preventDefault();const k={search:b};console.log("this is the console line 141",k),B.post("/category",k).then(x=>{console.log("this is the response for the cat line 133",x.data),i(x.data.listings)}).catch(x=>console.log(x))},children:[e("label",{htmlFor:"search"}),p.map((h,k)=>e("button",{className:"btn btn-active m-2 p-4 text-bold text-uppercase",value:h._id,onClick:x=>N(x.target.value),style:{backgroundColor:h.color},children:h.name},h._id)),e("button",{className:"btn btn-active m-2 p-5 text-bold text-uppercase",style:{backgroundColor:"#FFB396"},onClick:G,children:"All"})]})})}),a("div",{className:"row inline-flex-center",style:{color:"silver"},children:[e("div",{className:"col-6",children:e("button",{className:"btn btn-primary px-5 py-2 m-5",style:{backgroundColor:"#FF4646",border:0},value:"list",onClick:h=>g(h.target.value),children:"LIST"})}),e("div",{className:"col-6",children:e("button",{className:"btn btn-primary px-5 py- m-5",style:{backgroundColor:"#FF4646",border:0},value:"map",onClick:h=>g(h.target.value),children:"MAP"})})]}),a("div",{className:"d-flex-wrap justify-content-center",children:[u==="list"&&e("div",{id:"listing-card-div-flex",children:n.map(h=>{if(!h.archived)return e(S,{children:e(H,{listing:h},h._id)})})}),u==="map"&&e("div",{className:"col-12 d-inline-grid justify-content-center",children:a("div",{className:"row",children:[e("div",{className:"col-8",children:e($,{googleMapsApiKey:"AIzaSyAWNUhMz1o6js88esl8_xmRkQgFOZr38nk",children:e(j,{mapContainerStyle:I,center:_,zoom:14,children:n.map((h,k)=>{var x,A;return a("form",{children:[e("label",{htmlFor:h.name}),e(ae,{position:{lat:((x=h.coord)==null?void 0:x.lat)||-34.397,lng:((A=h.coord)==null?void 0:A.lng)||150.644},onClick:R=>oe(R,h._id,h.owner._id)})]},k)})})})}),e("div",{className:"col-4",children:Object.entries(c).length>0>0&&c.map(h=>e(H,{listing:h}))})]})})]})]})},He=()=>{const{currentUser:t}=E(),s=L(),r=l.exports.useRef(),[o,n]=l.exports.useState([]),[i,m]=l.exports.useState(0),[v,u]=l.exports.useState(""),{id:g}=Q();l.exports.useEffect(()=>{w.get("/listing/"+g).then(d=>{n(d.data)}).catch(d=>console.log("here err",d))},[]);const c=async d=>{try{const b={"Content-Type":"application/json"},N={token:d,listing:o};await w.post("/payment",{headers:b,body:N}),console.log("this is the qty and payment",i,v),console.log("this is the current user",t);const p={quantity:i,payment:v,listing:o._id,buyer:t._id};console.log("Do you arrive here?");const F=await w.post(`/listing/${o._id}`,p);console.log(F.data),s(`/account/bookings/${F.data._id}`)}catch(b){console.error(b)}},f=()=>{r.current.classList.toggle("collapse")},y=d=>{d.preventDefault()};return e(S,{children:e("div",{className:"background",children:a("div",{className:"display-flex-column align-content-center justify-content-center",children:[e("h1",{className:"p-5",children:"LISTING DETAILS"}),e("div",{className:"display-flex",children:a("div",{id:"listing-card-div-flex",children:[o.name&&e(H,{listing:o}),a("p",{children:[e("strong",{children:"GENERAL CONDITONS: "}),"Lorem ipsum dolor, sit amet consectetur adipisicing elit. Nisi sunt, labore hic tempora aut perferendis delectus nulla doloremque, totam excepturi, eaque officiis veritatis ipsum dolor suscipit debitis? Dolorem, error ea. Facilis, optio dignissimos possimus fugit reiciendis maiores ipsum quia tempora eveniet! Recusandae unde nam reiciendis facilis fuga numquam culpa enim ratione dignissimos sunt cumque quas totam esse, omnis debitis sint. Asperiores quam rem dolor, pariatur molestias excepturi omnis commodi, magnam saepe architecto quidem. Deleniti modi beatae assumenda voluptates esse mollitia iusto repellat, eum nam, optio perspiciatis, facilis quibusdam sit maxime."]})]})}),a("div",{className:"m-4",children:[e("button",{onClick:f,className:"btn btn-primary px-5 py-2",style:{backgroundColor:"#FF4646",border:0},type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseExample","aria-expanded":"false","aria-controls":"collapseExample",children:"BOOK THIS MEAL"}),e("div",{className:"collapse",id:"collapseExample",ref:r,children:e("div",{className:"card card-body",style:{backgroundColor:"#FFF5C0",border:0},children:a("form",{onSubmit:y,className:"p-4",children:[e("div",{className:"form-group m-3",children:e("label",{htmlFor:"label",className:"card-title",children:"Quantity"})}),e("div",{className:"form-group m-3",children:e("input",{type:"number",id:"label",min:"1",max:o.availableQuantity,onChange:d=>m(d.target.value)})}),e("div",{className:"form-group m-3",children:e("label",{htmlFor:"payment",children:"PAYMENT"})}),e("div",{className:"form-group m-3",children:a("select",{id:"payment",onChange:d=>u(d.target.value),children:[e("option",{id:"VISA",children:"VISA"}),e("option",{id:"MASTERCARD",children:"MASTERCARD"}),e("option",{id:"PAYPAL",children:"PAYPAL"})]})}),e(be,{stripeKey:"pk_test_51JjV4IFQMjZmhLvtv41yG1MNO82dIvPYFH39Hdgq0kwwDEt0lONLvlHT9eJE2Fl9EXn9dTZOTDhE2lV2QQLJCK2G00vCLBc6FC",token:c,name:"buy-something",amount:o.price*100,children:a("button",{className:"btn btn-primary px-5 py-2",style:{backgroundColor:"#FF4646",border:0},children:["$",o.price]})})]})})})]})]})})})},qe=()=>{const[t,s]=l.exports.useState(""),[r,o]=l.exports.useState(""),[n,i]=l.exports.useState(""),[m,v]=l.exports.useState(""),[u,g]=l.exports.useState(!0),c=L(),{businessId:f}=Ne().state,y=d=>{d.preventDefault(),w.post(`/api/listings/${f}/create`,{name:t,price:r,availableQuantity:n,description:m,recurring:u}).then(b=>{console.log("This is dbRes from line 15 of CreatingList",b),c("/dashboard")}).catch(b=>console.error(b))};return a("form",{className:"p-4",children:[e("h2",{className:"mx-3",children:"Your listing's info"}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"text",name:"name",placeholder:"Name of your listing",onChange:d=>s(d.target.value)})}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"number",name:"price",placeholder:"How much?",onChange:d=>o(d.target.value)})}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"number",name:"availableQuantity",placeholder:"How many?",onChange:d=>i(d.target.value)})}),e("div",{className:"form-group m-3",children:e("textarea",{className:"form-control",type:"text",name:"description",placeholder:"Please provide a short description",onChange:d=>v(d.target.value)})}),a("div",{className:"m-3",children:[e("h3",{children:"Is the listing reccuring?"}),e("label",{className:"mx-4",htmlFor:"recurring",children:"Yes"}),e("input",{type:"radio",idfor:"recurring",name:"recurring",value:!0,checked:u===!0,onChange:d=>g(d.target.value&&!0)}),e("label",{className:"mx-4",htmlFor:"recurring",children:"No"}),e("input",{type:"radio",idfor:"recurring",name:"recurring",checked:u===!1,value:!1,onChange:d=>g(d.target.value&&!1)})]}),e("button",{className:"btn btn-primary px-5 py-2",style:{backgroundColor:"#FF4646",border:0},onClick:d=>y(d),children:"Create a new listing"})]})},ze=()=>{const[t,s]=l.exports.useState(""),[r,o]=l.exports.useState(""),[n,i]=l.exports.useState(""),[m,v]=l.exports.useState(""),[u,g]=l.exports.useState(""),[c,f]=l.exports.useState(""),y=L(),{listingId:d}=Q();l.exports.useEffect(()=>{w.get(`/api/listings/${d}`).then(p=>{s(p.data.name),o(p.data.price),i(p.data.availableQuantity),v(p.data.description),g(p.data.recurring),f(p.data.archived)}).catch(p=>console.error(p))},[d]);const b=p=>{p.preventDefault(),w.patch(`/api/listings/modify/${d}`,{name:t,price:r,availableQuantity:n,description:m,recurring:u,archived:c}).then(()=>{y("/dashboard")}).catch(F=>console.error(F))};return a("form",{className:"p-4",onSubmit:p=>b(p),children:[e("h2",{className:"mx-3",children:"Your listing's info"}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"text",name:"name",id:"name",value:t,onChange:p=>s(p.target.value)})}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"number",name:"price",id:"price",value:r,onChange:p=>o(p.target.value)})}),e("div",{className:"form-group m-3",children:e("input",{className:"form-control",type:"number",name:"availableQuantity",id:"availableQuantity",value:n,onChange:p=>i(p.target.value)})}),e("div",{className:"form-group m-3",children:e("textarea",{className:"form-control",type:"text",name:"description",id:"description",value:m,onChange:p=>v(p.target.value)})}),a("div",{className:"m-5",children:[e("h3",{children:"Is the listing reccuring?"}),e("label",{className:"mx-4",htmlFor:"recurring",children:"Yes"}),e("input",{type:"radio",idfor:"recurring",name:"recurring",id:"recurring",value:!0,checked:u===!0,onChange:p=>g(p.target.checked&&!0)}),e("label",{className:"mx-4",htmlFor:"recurring",children:"No"}),e("input",{type:"radio",idfor:"recurring",name:"recurring",id:"recurring",value:!0,checked:u===!1,onChange:p=>g(p.target.value&&!1)})]}),a("div",{className:"m-5",children:[e("h3",{children:"Is the listing active?"}),u&&e("p",{className:"my-3",children:"Note: your listing is marked as recurring. Therefore, it will always be active by default."}),!u&&e("p",{className:"my-3",children:"Note: your listing is marked as non-recurring. Therefore, it will be set as inactive after today's end pickup date."}),e("label",{className:"mx-4",children:"Inactive"}),e(xe,{onChange:()=>{f(!c)},checked:!c}),e("label",{className:"mx-4",children:"Active"})]}),e("div",{className:"py-3",children:e("button",{style:{backgroundColor:"#FF4646",border:0},className:"btn btn-primary px-5 py-2",children:"Modify the listing"})})]})},$e=({booking:t})=>{var o,n,i,m,v,u,g;const s=L(),r=c=>{c.preventDefault(),w.delete(`/account/bookings/delete/${t._id}/${t.quantity}`).then(f=>{console.log(f.data),s("/account")}).catch(f=>console.log(f))};return e(S,{children:a("div",{className:"card background",style:{width:"30rem",backgroundColor:"#FFB396",height:"100vh"},children:[e("img",{className:"card-img-top",src:(n=(o=t.listing)==null?void 0:o.owner)==null?void 0:n.picture,alt:(i=t.listing)==null?void 0:i.name}),a("div",{className:"card-body",children:[a("div",{className:"row",children:[e("div",{className:"col-6",children:a("h5",{className:"card-title",children:["Reserved quantity : ",t.quantity]})}),e("div",{className:"col-6",children:a("h5",{className:"card-text",children:["Price: ",((m=t.listing)==null?void 0:m.price)*t.quantity,"\u20AC"]})}),e("hr",{})]}),a("div",{className:"row",children:[e("div",{className:"col-6",children:e("p",{className:"card-text",children:(u=(v=t.listing)==null?void 0:v.owner)==null?void 0:u.address})}),e("div",{className:"col-6",children:a("p",{className:"card-text",children:["Pick up by ",z((g=t.listing.owner)==null?void 0:g.endTimeSlot).format("ddd, hA")]})})]}),e("hr",{}),e("form",{onSubmit:r,children:e("button",{className:"btn btn-primary px-5 py-2",style:{backgroundColor:"#FF4646",border:0},children:"Cancel booking"})})]})]})})},je=()=>{const[t,s]=l.exports.useState({}),[r,o]=l.exports.useState([]);return l.exports.useEffect(()=>{w.get("/account").then(n=>{console.log(n.data),s(n.data)}).catch(n=>console.log(n))},[]),l.exports.useEffect(()=>{w.get("/api/business/my-business").then(n=>{n.data[0].listings.forEach(i=>w.get(`/my-booking/${i}`).then(m=>{o(v=>{const u=[...v];return u.push(...m.data),u})}).catch(m=>console.error(m)))}).catch(n=>console.error(n))},[]),e(S,{children:a("div",{className:"container-fluid background",children:[a("h1",{className:"p-5",style:{color:"#FF4646"},children:["WELCOME ",t.name]}),t.role==="user"&&a(S,{children:[e("h3",{children:"YOUR BOOKINGS"}),!t.bookings&&e("p",{children:"You don't have any bookings for the moment"}),t.bookings&&t.bookings.length>0&&t.bookings.map(n=>{var i,m,v,u,g,c,f;return e(S,{children:e("div",{className:"d-inline-flex",children:e("div",{className:"card my-3",style:{maxWidth:"50vw",borderRadius:"10px",backgroundColor:"#FFB396"},children:a("div",{className:"row",children:[e("h5",{className:"card-title text-uppercase",style:{color:"#FF4646"},children:e("span",{children:n.listing.name})}),e("hr",{}),e("div",{className:"col-6 text-justify",children:e("img",{className:"img-responsive text-center",src:(m=(i=n.listing)==null?void 0:i.owner)==null?void 0:m.picture,alt:(v=n.listing)==null?void 0:v.name,style:{position:"relative",borderRadius:"10px"}})}),a("div",{className:"col-6",children:[a("div",{className:"card-body",children:[a("div",{className:"d-inline-flex text-uppercase m-3",children:[e("div",{children:a("h5",{className:"card-title",children:["QUANTITY:  ",a("span",{children:[n.quantity,"  "]})]})}),e("hr",{}),a("h5",{className:"card-text",children:["Price:  ",a("span",{className:"text-danger",children:[((u=n.listing)==null?void 0:u.price)*n.quantity,"\u20AC"]})]})]}),e("p",{className:"card-text",children:(c=(g=n.listing)==null?void 0:g.owner)==null?void 0:c.address}),a("p",{className:"card-text",children:["Pick up by ",z((f=n.listing.owner)==null?void 0:f.endTimeSlot).format("ddd, hA")]})]}),e(se,{to:`/account/bookings/${n._id}`,children:"See this booking"})]})]})})})})})]}),t.role==="business"&&a(S,{children:[e("h3",{children:"My Bookings"}),!r&&e("p",{children:"You don't have any bookings for the moment"}),r&&e(S,{children:e("div",{className:"d-inline-flex-wrap row justify-content-center",children:r.map(n=>a("div",{style:{width:"300px",border:"1px solid #FF8585",borderRadius:"20px"},className:"m-4 p-2",children:[a("h3",{children:["Buyer: ",n.buyer.name]}),a("p",{children:["Listing: ",n.listing.name]}),a("p",{children:["Quantity: ",n.quantity]})]}))})})]})]})})};T.setApiKey("AIzaSyAWNUhMz1o6js88esl8_xmRkQgFOZr38nk");T.setLanguage("fr");const Qe=()=>{var u,g,c,f,y;const{id:t}=Q();L();const[s,r]=l.exports.useState(null),[o,n]=l.exports.useState({}),i={width:"auto",height:"100vh",className:"container-fluid"};l.exports.useEffect(()=>{w.get(`/account/bookings/${t}`).then(d=>{console.log(d.data),r(d.data)}).catch(d=>console.log(d))},[t]),l.exports.useEffect(()=>{s!==null&&v()},[s]);const m=d=>new Promise(async(b,N)=>{try{let p=d.listing.owner.address;const F=await T.fromAddress(p),{lat:I,lng:_}=F.results[0].geometry.location;console.log("lat long",I,_),b({lat:I,lng:_})}catch(p){N(p)}}),v=async()=>{try{const d=await m(s);console.log(">>",d),n(d),console.log("this is the booking with the coordinates",s),console.log("this is lat and long",o)}catch(d){console.error(d)}};return console.log("booking",s),s&&((u=s==null?void 0:s.listing)==null?void 0:u.coord)&&console.log({lat:Number((c=(g=s==null?void 0:s.listing)==null?void 0:g.coord)==null?void 0:c.lat),lng:Number((y=(f=s==null?void 0:s.listing)==null?void 0:f.coord)==null?void 0:y.lng)}),e("div",{className:"container",children:s&&a("div",{className:"row",children:[e("div",{className:"col-6",children:e($e,{booking:s})}),e("div",{className:"col-6",children:e($,{googleMapsApiKey:"AIzaSyAWNUhMz1o6js88esl8_xmRkQgFOZr38nk",children:e(j,{mapContainerStyle:i,center:{lat:(o==null?void 0:o.lat)||45,lng:(o==null?void 0:o.lng)||50},zoom:20,children:e(ae,{position:{lat:(o==null?void 0:o.lat)||-34.397,lng:(o==null?void 0:o.lng)||150.644}})})})})]})})},Ye=()=>{const t=l.exports.useRef(),[s,r]=l.exports.useState([]),[o,n]=l.exports.useState(""),[i,m]=l.exports.useState("");l.exports.useEffect(()=>{w.get("/favorites").then(f=>{console.log(f.data),r(f.data.favorites),console.log("those are the favorites",s)}).catch(f=>console.log(f))},[]);const v=()=>{t.current.classList.toggle("collapse")},u=f=>{f.preventDefault(),console.log("this is the content",o);const y={content:o,favoriteId:i};w.post("/api/review/create",y).then(d=>{console.log("this is what comes back from res data",d.data._id),r(b=>{const N=b.filter(I=>I._id!==d.data._id),p=d.data;return[...N,p]})}).catch(d=>console.log(d))},g=(f,y)=>{m(y)},c=(f,y,d)=>{console.log("this is the complete array normally",d),console.log("this is the reviewId",y);let b;d.map((p,F,I)=>{p.reviews.find(_=>_._id===y)?b=F:b=0}),console.log(b);let N=d[b]._id;console.log(N),w.delete(`/api/review/delete/${y}/${N}`).then(p=>{console.log(p.data),r(F=>{const I=F.filter(q=>q._id!==p.data._id);console.log("pls get there",I);const _=p.data;return console.log("new value",_),[...I,_]})}).catch(p=>console.log(p))};return e(S,{children:a("div",{className:"container-fluid pt-3 pb-3 background",children:[e("h3",{className:"text-uppercase",style:{color:"#FFF5C0"},children:"Your favorite restaurants"}),e("div",{className:"row pt-3",children:s.map((f,y,d)=>a(S,{children:[e("div",{className:"col-6",children:a("div",{className:"card",style:{width:"auto",margin:"2%",borderRadius:"10px",color:"#FFF5C0",backgroundColor:"#E97171"},children:[e("img",{className:"img-responsive",src:f.picture,alt:f.name,style:{borderRadius:"2%"}}),a("div",{className:"card-body",children:[e("h5",{className:"card-title text-uppercase",style:{color:"#FFF5C0"},children:f.name}),e("p",{className:"card-text",children:f.description}),f.reviews&&f.reviews.map(b=>{var N;return a("div",{style:{color:"white",width:"auto",margin:"2rem",padding:"4em"},className:"d-inline-flex p-1 bg-dark",children:[a("p",{children:[b.content," by ",e("span",{style:{color:"#FFB396"},children:(N=b.writer)==null?void 0:N.name})]}),e("span",{style:{cursor:"pointer"},onClick:p=>c(p,b._id,d),className:"col-sm p-4",children:e(ee,{size:24})})]})})]})]})}),a("div",{className:"col-6",children:[e("p",{children:e("button",{onClick:v,className:"btn px-5 py-2",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseExample","aria-expanded":"false","aria-controls":"collapseExample",style:{backgroundColor:"#FF4646",color:"#FFB396"},children:"LEAVE A REVIEW FOR THIS ENTERPRISE"})}),e("div",{className:"collapse",id:"collapseExample",style:{backgroundColor:"#fff5c0"},ref:t,children:e("div",{className:"card card-body",style:{backgroundColor:"#fff5c0"},children:a("form",{className:"p-4",onSubmit:u,onChange:b=>g(b,f._id),children:[a("div",{className:"form-group m-3",children:[e("label",{htmlFor:"comment",className:"card-title"}),e("input",{type:"text",id:"comment",min:"1",className:"form-control-file",style:{width:"80%",height:"300px"},onChange:b=>n(b.target.value)})]}),e("button",{className:"btn px-5 py-2",style:{color:"#FF4646",fontWeight:"bolder"},children:"POST COMMENT"})]})})})]})]}))})]})})};function We(){const[t,s]=l.exports.useState("user");return a("div",{className:"App",children:[e(Ae,{}),a(we,{children:[e(C,{path:"/",element:e(Le,{setRole:s})}),e(C,{path:"/signup",element:e(Te,{role:t})}),e(C,{path:"/login",element:e(Ie,{role:t})}),a(C,{element:e(Ue,{}),children:[e(C,{path:"/discover",element:e(Pe,{})}),e(C,{path:"/account",element:e(je,{})}),e(C,{path:"/account/bookings/:id",element:e(Qe,{})}),e(C,{path:"/dashboard",element:e(Re,{})}),e(C,{path:"/onboarding",element:e(Me,{})}),e(C,{path:"/listings/create",element:e(qe,{})}),e(C,{path:"/listings/:listingId/update",element:e(ze,{})}),e(C,{path:"/favorites",element:e(Ye,{})})]}),e(C,{path:"/listings",element:e(Be,{})}),e(C,{path:"/listing/:id",element:e(He,{})})]})]})}const Ge=({children:t})=>{const[s,r]=l.exports.useState({currentUser:null,isLoading:!0,isLoggedIn:!1});l.exports.useEffect(()=>{o()},[]);const o=()=>{const u=localStorage.getItem("authToken");u?B.isLoggedIn(u).then(g=>{console.log(g),r({currentUser:g,isLoading:!1,isLoggedIn:!0})}).catch(g=>{r({currentUser:null,isLoading:!1,isLoggedIn:!1})}):r({currentUser:null,isLoading:!1,isLoggedIn:!1})},n=()=>{i(),o()},i=()=>{localStorage.removeItem("authToken")},m=u=>{localStorage.setItem("authToken",u),o()},v={currentUser:s.currentUser,isLoading:s.isLoading,isLoggedIn:s.isLoggedIn,removeUser:n,storeToken:m,authenticateUser:o};return e(ne.Provider,{value:v,children:t})};Se.render(e(ke.StrictMode,{children:e(Ce,{children:e(Ge,{children:e(We,{})})})}),document.getElementById("root"));
